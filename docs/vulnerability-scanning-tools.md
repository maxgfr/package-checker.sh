# Vulnerability Scanning Tools

This guide covers various tools that can generate vulnerability reports compatible with package-checker.sh. These tools scan your projects and output results in SARIF, SBOM (CycloneDX), or Trivy JSON formats.

**Note:** package-checker.sh now includes built-in vulnerability feeds (GHSA and OSV) in the `data/` folder, so you can start scanning immediately without external tools. However, these scanning tools are still useful for:

- Generating additional vulnerability reports in different formats
- Cross-validating results from multiple sources
- Creating SBOMs for supply chain security
- Integrating with other security workflows

## ðŸ“‹ Table of Contents

- [Trivy](#trivy)
- [Depscan](#depscan)
- [Grype](#grype)
- [Syft](#syft)
- [OSV-Scanner](#osv-scanner)
- [Semgrep](#semgrep)
- [Snyk](#snyk)
- [npm audit](#npm-audit)
- [Quick Comparison](#quick-comparison)

---

## Trivy

**Trivy** is a comprehensive security scanner for containers, filesystems, git repositories, and more. It's one of the most popular open-source vulnerability scanners.

### Installation

```bash
# macOS
brew install trivy

# Linux
wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
echo "deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main" | sudo tee -a /etc/apt/sources.list.d/trivy.list
sudo apt-get update
sudo apt-get install trivy

# Docker
docker pull aquasec/trivy:latest
```

### Usage with package-checker.sh

**Generate SARIF format:**

```bash
# Scan filesystem and output SARIF
trivy fs --format sarif --output vulnerabilities.sarif .

# Scan with severity filtering
trivy fs --format sarif --severity HIGH,CRITICAL --output vulnerabilities.sarif .

# Use with package-checker
./script.sh --source vulnerabilities.sarif --format sarif
```

**Generate SBOM CycloneDX format:**

```bash
# Generate SBOM in CycloneDX JSON format
trivy fs --format cyclonedx --output sbom.cdx.json .

# Or use the SBOM subcommand
trivy sbom --format cyclonedx-json --output sbom.cdx.json .

# Use with package-checker
./script.sh --source sbom.cdx.json --format sbom-cyclonedx
```

**Generate Trivy JSON format:**

```bash
# Scan filesystem with JSON output
trivy fs --format json --output trivy-report.json .

# Scan container image
trivy image --format json --output trivy-report.json nginx:latest

# Scan with offline mode (using cached DB)
trivy fs --format json --offline --output trivy-report.json .

# Use with package-checker
./script.sh --source trivy-report.json --format trivy-json
```

**Official Documentation:** [https://trivy.dev](https://trivy.dev)

---

## Depscan

**Depscan** (by OWASP) is a security audit tool for project dependencies that supports multiple languages and package managers. It can generate SARIF reports for vulnerability findings.

### Installation

```bash
# Using pip
pip install owasp-depscan

# Using Docker
docker pull ghcr.io/owasp-dep-scan/dep-scan:latest

# Install cdxgen for SBOM generation
npm install -g @cyclonedx/cdxgen
```

### Usage with package-checker.sh

**Generate SARIF format:**

```bash
# Scan current directory and generate SARIF report
depscan --src . --report_file vulnerabilities.sarif

# Scan with specific type (e.g., nodejs, python, go)
depscan --src . --type nodejs --report_file vulnerabilities.sarif

# Scan with severity threshold
depscan --src . --severity critical,high --report_file vulnerabilities.sarif

# Use with package-checker
./script.sh --source vulnerabilities.sarif --format sarif
```

**Generate SBOM CycloneDX format:**

```bash
# Generate SBOM with cdxgen (companion tool)
cdxgen -o sbom.json -t nodejs .

# Or use depscan's built-in SBOM generation
depscan --src . --bom sbom.json

# Use with package-checker
./script.sh --source sbom.json --format sbom-cyclonedx
```

**Advanced Options:**

```bash
# Scan with custom vulnerability database
depscan --src . --vdb-path /path/to/custom/db --report_file vulnerabilities.sarif

# Scan multiple project types
depscan --src . --type nodejs,python --report_file vulnerabilities.sarif

# Generate both SARIF and SBOM
depscan --src . --report_file vulnerabilities.sarif --bom sbom.json

# Use both with package-checker
./script.sh --source vulnerabilities.sarif --format sarif
./script.sh --source sbom.json --format sbom-cyclonedx
```

**Key Features:**

- **Multi-language support**: Node.js, Python, Java, Go, Ruby, PHP, .NET, Rust, and more
- **SARIF output**: Native SARIF 2.1.0 format support
- **SBOM generation**: CycloneDX format via cdxgen integration
- **Multiple databases**: Uses OSV, NVD, GitHub Advisory, and custom sources
- **CI/CD friendly**: Exit codes based on findings, easy integration
- **Fast scanning**: Optimized for large projects

**Official Documentation:** [https://github.com/owasp-dep-scan/dep-scan](https://github.com/owasp-dep-scan/dep-scan)

---

## Grype

**Grype** is a vulnerability scanner for container images and filesystems by Anchore.

### Installation

```bash
# macOS
brew install grype

# Linux
curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh -s -- -b /usr/local/bin

# Docker
docker pull anchore/grype:latest
```

### Usage with package-checker.sh

**Generate SBOM CycloneDX format:**

```bash
# Scan directory and output CycloneDX SBOM
grype dir:. -o cyclonedx-json > sbom.json

# Scan with specific scope (all-layers, squashed)
grype dir:. -o cyclonedx-json --scope all-layers > sbom.json

# Scan container image
grype nginx:latest -o cyclonedx-json > sbom.json

# Use with package-checker
./script.sh --source sbom.json --format sbom-cyclonedx
```

**Note:** Grype primarily outputs in its own JSON format and CycloneDX. For SARIF output, you may need to use conversion tools.

**Official Documentation:** [https://github.com/anchore/grype](https://github.com/anchore/grype)

---

## Syft

**Syft** is an SBOM (Software Bill of Materials) generator by Anchore. It catalogs packages and dependencies.

### Installation

```bash
# macOS
brew install syft

# Linux
curl -sSfL https://raw.githubusercontent.com/anchore/syft/main/install.sh | sh -s -- -b /usr/local/bin

# Docker
docker pull anchore/syft:latest
```

### Usage with package-checker.sh

**Generate SBOM CycloneDX format:**

```bash
# Generate SBOM from directory
syft . -o cyclonedx-json > sbom.json

# Scan container image
syft nginx:latest -o cyclonedx-json > sbom.json

# Include file metadata
syft dir:. -o cyclonedx-json --scope all-layers > sbom.json

# Use with package-checker
./script.sh --source sbom.json --format sbom-cyclonedx
```

**Note:** Syft focuses on SBOM generation. Combine it with Grype for vulnerability detection.

**Official Documentation:** [https://github.com/anchore/syft](https://github.com/anchore/syft)

---

## OSV-Scanner

**OSV-Scanner** is a vulnerability scanner by Google that uses the OSV (Open Source Vulnerabilities) database.

### Installation

```bash
# Go install
go install github.com/google/osv-scanner/cmd/osv-scanner@latest

# Download binary
# Visit: https://github.com/google/osv-scanner/releases

# Docker
docker pull ghcr.io/google/osv-scanner:latest
```

### Usage with package-checker.sh

**Generate SARIF format:**

```bash
# Scan current directory with SARIF output
osv-scanner --format sarif -r . > vulnerabilities.sarif

# Scan specific lockfile
osv-scanner --format sarif --lockfile package-lock.json > vulnerabilities.sarif

# Scan with offline mode
osv-scanner --format sarif --offline -r . > vulnerabilities.sarif

# Use with package-checker
./script.sh --source vulnerabilities.sarif --format sarif
```

**Official Documentation:** [https://google.github.io/osv-scanner](https://google.github.io/osv-scanner)

---

## Semgrep

**Semgrep** is a fast, open-source static analysis tool for finding bugs and enforcing code standards.

### Installation

```bash
# macOS
brew install semgrep

# Python pip
pip install semgrep

# Docker
docker pull returntocorp/semgrep:latest
```

### Usage with package-checker.sh

**Generate SARIF format:**

```bash
# Scan with default rules
semgrep --config=auto --sarif -o vulnerabilities.sarif .

# Scan with specific ruleset
semgrep --config "p/security-audit" --sarif -o vulnerabilities.sarif .

# Scan JavaScript/TypeScript only
semgrep --config=auto --sarif --include='*.js' --include='*.ts' -o vulnerabilities.sarif .

# Use with package-checker
./script.sh --source vulnerabilities.sarif --format sarif
```

**Official Documentation:** [https://semgrep.dev](https://semgrep.dev)

---

## Snyk

**Snyk** is a commercial developer security platform with a free tier for open-source projects.

### Installation

```bash
# npm
npm install -g snyk

# macOS
brew install snyk

# Sign up and authenticate
snyk auth
```

### Usage with package-checker.sh

**Generate SARIF format:**

```bash
# Test and output SARIF
snyk test --sarif-file-output=vulnerabilities.sarif

# Test with all projects
snyk test --all-projects --sarif-file-output=vulnerabilities.sarif

# Test container image
snyk container test nginx:latest --sarif-file-output=vulnerabilities.sarif

# Use with package-checker
./script.sh --source vulnerabilities.sarif --format sarif
```

**Generate SBOM (CycloneDX):**

```bash
# Generate SBOM in CycloneDX format
snyk sbom --format=cyclonedx1.4+json --json > sbom.json

# Use with package-checker
./script.sh --source sbom.json --format sbom-cyclonedx
```

**Official Documentation:** [https://docs.snyk.io](https://docs.snyk.io)

---

## npm audit

**npm audit** is built into npm and analyzes your dependencies for vulnerabilities.

### Usage

While npm audit doesn't directly output SARIF or SBOM formats, you can use it with converters:

```bash
# Run npm audit with JSON output
npm audit --json > npm-audit.json

# Use converter tools to transform to SARIF
# Example with npm-audit-sarif (install: npm i -g npm-audit-sarif)
npm audit --json | npm-audit-sarif > vulnerabilities.sarif

# Use with package-checker
./script.sh --source vulnerabilities.sarif --format sarif
```

---

## Quick Comparison

| Tool | SARIF | SBOM (CycloneDX) | Trivy JSON | Speed | Open Source | Best For |
|------|-------|------------------|------------|-------|-------------|----------|
| **Trivy** | âœ… | âœ… | âœ… | Fast | âœ… | All-in-one scanning |
| **Depscan** | âœ… | âœ… | âŒ | Fast | âœ… | Multi-language projects |
| **Grype** | âš ï¸ | âœ… | âŒ | Fast | âœ… | Container & filesystem |
| **Syft** | âŒ | âœ… | âŒ | Very Fast | âœ… | SBOM generation |
| **OSV-Scanner** | âœ… | âŒ | âŒ | Fast | âœ… | OSV database |
| **Semgrep** | âœ… | âŒ | âŒ | Fast | âœ… | Static analysis |
| **Snyk** | âœ… | âœ… | âŒ | Medium | âš ï¸ (Free tier) | Enterprise features |

---

## Recommended Workflows

### Quick Start with Built-in Feeds

```bash
# Use built-in GHSA feed (no external tools needed!)
./script.sh --source data/ghsa.purl

# Or use both GHSA and OSV feeds for comprehensive coverage
./script.sh --source data/ghsa.purl --source data/osv.purl

# With Docker
docker run -v $(pwd):/workspace ghcr.io/maxgfr/package-checker.sh:latest --source data/ghsa.purl
```

### Workflow: Built-in Feeds + External Scanners

Combine built-in vulnerability feeds with scanner outputs for maximum coverage:

```bash
# 1. Scan with built-in feeds
./script.sh --source data/ghsa.purl

# 2. Generate additional reports with Trivy
trivy fs --format sarif --output vulnerabilities.sarif .
trivy fs --format json --output trivy-report.json .

# 3. Combine all sources
./script.sh --source data/ghsa.purl \
            --source vulnerabilities.sarif \
            --source trivy-report.json
```

### Workflow: Container Images

```bash
# 1. Use built-in feeds first
./script.sh --source data/ghsa.purl

# 2. Scan container with Trivy for additional findings
trivy image --format json nginx:latest > trivy-nginx.json

# 3. Generate SBOM with Syft
syft nginx:latest -o cyclonedx-json > nginx-sbom.json

# 4. Check all sources
./script.sh --source data/ghsa.purl \
            --source trivy-nginx.json \
            --source nginx-sbom.json
```

### Workflow: CI/CD Integration

```bash
# Option 1: Use built-in feeds only (fastest, no external dependencies)
./script.sh --source data/ghsa.purl

# Option 2: Combine built-in feeds with scanners
osv-scanner --format sarif -r . > osv-vulnerabilities.sarif
./script.sh --source data/ghsa.purl --source osv-vulnerabilities.sarif

# Option 3: Multi-source validation
trivy fs --format json --severity HIGH,CRITICAL --output trivy.json .
./script.sh --source data/ghsa.purl \
            --source data/osv.purl \
            --source trivy.json
```

---

## Additional Resources

- **SARIF Specification:** [https://sarifweb.azurewebsites.net](https://sarifweb.azurewebsites.net)
- **CycloneDX Specification:** [https://cyclonedx.org](https://cyclonedx.org)
- **OWASP Dependency-Check:** [https://owasp.org/www-project-dependency-check](https://owasp.org/www-project-dependency-check)
- **GitHub Advisory Database:** [https://github.com/advisories](https://github.com/advisories)
- **OSV Database:** [https://osv.dev](https://osv.dev)

---

**Need help?** Open an issue on [GitHub](https://github.com/maxgfr/package-checker.sh/issues).
